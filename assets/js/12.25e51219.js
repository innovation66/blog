(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{584:function(t,a,s){t.exports=s.p+"assets/img/image-20220531164127062.450d1513.png"},637:function(t,a,s){"use strict";s.r(a);var n=s(5),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"javascrit-引擎"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#javascrit-引擎"}},[t._v("#")]),t._v(" JavaScrit 引擎")]),t._v(" "),n("h3",{attrs:{id:"认识-javascrit-引擎"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#认识-javascrit-引擎"}},[t._v("#")]),t._v(" 认识 JavaScrit 引擎")]),t._v(" "),n("ul",[n("li",[t._v("为什么需要 JavaScrit 引擎呢？\n"),n("ul",[n("li",[t._v("我们前面说过，高级的编程语言都是需要转成最终的机器指令来执行的；")]),t._v(" "),n("li",[t._v("事实上我们编写的 JavaScrit 无论你交给浏览器或者 Node 执行，最后都是需要被 CU 执行的；")]),t._v(" "),n("li",[t._v("但是 CU 只认识自己的指令集，实际上是机器语言，才能被 CU 所执行；")]),t._v(" "),n("li",[t._v("所以我们需要 JavaScrit 引擎帮助我们将 JavaScrit 代码翻译成 CU 指令来执行；")])])]),t._v(" "),n("li",[t._v("比较常见的 JavaScrit 引擎有哪些呢？\n"),n("ul",[n("li",[t._v("SiderMonkey：第一款 JavaScrit 引擎，由 BrendaEich 开发（也就是 JavaScrit 作者）；")]),t._v(" "),n("li",[t._v("Chakra：微软开发，用于 IT 浏览器；")]),t._v(" "),n("li",[t._v("JavaScritCore：WebKit 中的 JavaScrit 引擎，Ale 公司开发；")]),t._v(" "),n("li",[t._v("V8：Google 开发的强大 JavaScrit 引擎，也帮助 Chrome 从众多浏览器中脱颖而出；")]),t._v(" "),n("li",[t._v("等等…")])])])]),t._v(" "),n("h3",{attrs:{id:"浏览器内核和-js-引擎的关系"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器内核和-js-引擎的关系"}},[t._v("#")]),t._v(" 浏览器内核和 JS 引擎的关系")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("这里我们先以 WebKit 为例，WebKit 事实上由两部分组成的：")]),t._v(" "),n("ul",[n("li",[t._v("WebCore：负责 HTML 解析、布局、渲染等等相关的工作；")]),t._v(" "),n("li",[t._v("JavaScritCore：解析、执行 JavaScrit 代码；")])])]),t._v(" "),n("li",[n("p",[t._v("看到这里，学过小程序的同学有没有感觉非常的熟悉呢？")]),t._v(" "),n("ul",[n("li",[t._v("在小程序中编写的 JavaScrit 代码就是被 JSCore 执行的；")])]),t._v(" "),n("p",[n("img",{attrs:{src:s(584),alt:"image-20220531164127062"}}),n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20211021091037753.png",alt:"image-20211021091037753"}})])]),t._v(" "),n("li",[n("p",[t._v("另外一个强大的 JavaScrit 引擎就是 V8 引擎。")])])]),t._v(" "),n("h2",{attrs:{id:"v8-引擎"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#v8-引擎"}},[t._v("#")]),t._v(" V8 引擎")]),t._v(" "),n("h3",{attrs:{id:"v8-引擎的执行原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#v8-引擎的执行原理"}},[t._v("#")]),t._v(" V8 引擎的执行原理")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("我们来看一下官方对 V8 引擎的定义：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("V8 是用 C ++编写的 Google 开源高性能 JavaScrit 和 WebAssembly 引擎，它用于 Chrome 和 Node.js 等。")])]),t._v(" "),n("li",[n("p",[t._v("它实现 ECMAScrit 和 WebAssembly，并在 Windows 7 或更高版本，macOS 10.12+和使用 x64，IA-32，ARM 或 MIS 处理器的 Linux 系统上运行。")])]),t._v(" "),n("li",[n("p",[t._v("V8 可以独立运行，也可以嵌入到任何 C ++应用程序中。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20211021094120801.png",alt:"image-20211021094120801"}})])])])]),t._v(" "),n("li",[n("p",[t._v("拓展知识")]),t._v(" "),n("ul",[n("li",[t._v("TurboFan 可以收集函数的一些执行信息，当一个函数执行频率非常高的时候，会将这个函数标记为 hot，当一个函数称为热函数的时候，就被转换成为机器码再保存下来，重复执行，减少字节码—>机器码的转换的过程")]),t._v(" "),n("li",[t._v("当函数中类型发生变化的时候，进行 Deoptimization 的过程，机器码再转换回字节码")])])])]),t._v(" "),n("h3",{attrs:{id:"v8-引擎的架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#v8-引擎的架构"}},[t._v("#")]),t._v(" V8 引擎的架构")]),t._v(" "),n("ul",[n("li",[t._v("V8 引擎本身的源码非常复杂，大概有超过 100w 行 C++代码，通过了解它的架构，我们可以知道它是如何对 JavaScrit 执行的：")]),t._v(" "),n("li",[t._v("Parse 模块会将 JavaScrit 代码转换成 AST（抽象语法树），这是因为解释器并不直接认识 JavaScrit 代码；\n"),n("ul",[n("li",[t._v("如果函数没有被调用，那么是不会被转换成 AST 的；")]),t._v(" "),n("li",[t._v("Parse 的 V8 官方文档：https://v8.dev/blog/scanner")])])]),t._v(" "),n("li",[t._v("Ignition 是一个解释器，会将 AST 转换成 ByteCode（字节码）\n"),n("ul",[n("li",[t._v("同时会收集 TurboFan 优化所需要的信息（比如函数参数的类型信息，有了类型才能进行真实的运算）；")]),t._v(" "),n("li",[t._v("如果函数只调用一次，Ignition 会执行解释执行 ByteCode；")]),t._v(" "),n("li",[t._v("Ignition 的 V8 官方文档：https://v8.dev/blog/ignition-interreter")])])]),t._v(" "),n("li",[t._v("TurboFan 是一个编译器，可以将字节码编译为 CU 可以直接执行的机器码；\n"),n("ul",[n("li",[t._v("如果一个函数被多次调用，那么就会被标记为热点函数，那么就会经过 TurboFan 转换成优化的机器码，提高代码的执行性能；")]),t._v(" "),n("li",[t._v("但是，机器码实际上也会被还原为 ByteCode，这是因为如果后续执行函数的过程中，类型发生了变化（比如 sum 函数原来执行的是 number 类型，后来执行变成了 string 类型），之前优化的机器码并不能正确的处理运算，就会逆向的转换成字节码；")]),t._v(" "),n("li",[t._v("TurboFan 的 V8 官方文档：https://v8.dev/blog/turbofan-jit")])])])]),t._v(" "),n("h3",{attrs:{id:"v8-引擎的解析图-1-官方"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#v8-引擎的解析图-1-官方"}},[t._v("#")]),t._v(" V8 引擎的解析图 1（官方）")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20211021094313898.png",alt:"image-20211021094313898"}})]),t._v(" "),n("h3",{attrs:{id:"v8-引擎解析图-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#v8-引擎解析图-2"}},[t._v("#")]),t._v(" V8 引擎解析图 2")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20220531164442656.png",alt:"image-20220531164442656"}})]),t._v(" "),n("h3",{attrs:{id:"v8-执行的细节"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#v8-执行的细节"}},[t._v("#")]),t._v(" V8 执行的细节")]),t._v(" "),n("ol",[n("li",[t._v("那么我们的 JavaScrit 源码是如何被解析（Parse 过程）的呢？")]),t._v(" "),n("li",[t._v("Blink 将源码交给 V8 引擎，Stream 获取到源码并且进行编码转换；")]),t._v(" "),n("li",[t._v("Scanner 会进行词法分析（lexical analysis），词法分析会将代码转换成 tokens；")]),t._v(" "),n("li",[t._v("接下来 tokens 会被转换成 AST 树，经过 Parser 和 Prearser：\n"),n("ul",[n("li",[t._v("Parser 就是直接将 tokens 转成 AST 树架构；")]),t._v(" "),n("li",[t._v("Prearser 称之为预解析，为什么需要预解析呢？\n"),n("ul",[n("li",[t._v("这是因为并不是所有的 JavaScrit 代码，在一开始时就会被执行。那么对所有的 JavaScrit 代码进行解析，必然会影响网页的运行效率；\n"),n("ul",[n("li",[t._v("比如说某些还没有调用的函数，会先进行预解析，然后再代码后续执行到了这个位置后再进行全解析")])])]),t._v(" "),n("li",[t._v("所以 V8 引擎就实现了 Lazy arsing（延迟解析）的方案，它的作用是将不必要的函数进行预解析，也就是只解析暂时需要的内容，而对函数的全量解析是在函数被调用时才会进行；")]),t._v(" "),n("li",[t._v("比如我们在一个函数 outer 内部定义了另外一个函数 inner，那么 inner 函数就会进行预解析；")])])])])]),t._v(" "),n("li",[t._v("生成 AST 树后，会被 Ignition 转成字节码（bytecode），之后的过程就是代码的执行过程（后续会详细分析）。")])]),t._v(" "),n("h2",{attrs:{id:"javascript-执行过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#javascript-执行过程"}},[t._v("#")]),t._v(" JavaScript 执行过程")]),t._v(" "),n("h3",{attrs:{id:"javascript-的执行过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#javascript-的执行过程"}},[t._v("#")]),t._v(" JavaScript 的执行过程")]),t._v(" "),n("p",[t._v("假如我们有下面一段代码，它在 JavaScrit 中是如何被执行的呢？")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mjjh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" num1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" num2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" num1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" num2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])]),n("ol",[n("li",[t._v("首先在全局作用域初始化变量 GO\n"),n("ol",[n("li",[t._v("如果是引用类型则以 对象类型 对象名 堆内存地址(未赋值)")]),t._v(" "),n("li",[t._v("如果不是引用类型则以 对象类型 对象名 值(未赋值)")])])]),t._v(" "),n("li",[t._v('然后开始执行,例如执行到 var name = "mjjh",就是将对应的值存放或者是将堆内存地址存入变量')]),t._v(" "),n("li",[t._v("执行到函数时会创建一个 FEC(函数执行上下文),并且将其压栈到执行上下文中,同时在堆内存中初始化 AO 对象(activation)")]),t._v(" "),n("li",[t._v("等待函数执行完成后,FEC 将会弹出,此时由于没有执行上下文指向 AO 对象,js 引擎会触发垃圾回收机制将其回收")])]),t._v(" "),n("h3",{attrs:{id:"概念补充"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概念补充"}},[t._v("#")]),t._v(" 概念补充")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("执行环境栈（Execution Context Stack）")]),t._v(" "),n("ul",[n("li",[t._v("浏览器会从计算机内存中分配一块内存，专门用来供代码执行")]),t._v(" "),n("li",[t._v("javascript 是单线程的，这意味着他只有一个调用栈")]),t._v(" "),n("li",[t._v("基础数据类型存储在栈中")])])]),t._v(" "),n("li",[n("p",[t._v("堆内存（Heap）")]),t._v(" "),n("ul",[n("li",[t._v("存放属性方法")]),t._v(" "),n("li",[t._v("任何开辟的堆内存都有一个 16 进制的内存地址，存储在栈中，供变量调用")]),t._v(" "),n("li",[t._v("引用数据类型存储会开辟一个堆内存，把内容存进去，然后把地址放到栈中供变量关联使用")])])]),t._v(" "),n("li",[n("p",[t._v("全局对象（Global Object）")]),t._v(" "),n("ul",[n("li",[t._v("是一个堆内存，存储的是浏览器内置的属性和方法")]),t._v(" "),n("li",[t._v("浏览器中 window 指向全局对象")])])]),t._v(" "),n("li",[n("p",[t._v("VO（Varibale Object）")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("变量对象，在当前的上下文中，用来存放创建的变量和值的地方")])]),t._v(" "),n("li",[n("p",[t._v("每一个执行上下文会关联一个 VO（Variable Object，变量对象），变量和函数声明会被添加到这个 VO 对象中。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20220531165713781.png",alt:"image-20220531165713781"}})])]),t._v(" "),n("li",[n("p",[t._v("函数私有上下文中叫做 AO（Activation Object）活动对象")])]),t._v(" "),n("li",[n("p",[t._v("当全局代码被执行的时候, VO 也就是 GO(Global Object)全局对象")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20220531165804085.png",alt:"image-20220531165804085"}})])])])]),t._v(" "),n("li",[n("p",[t._v("执行上下文（Execution Context）")]),t._v(" "),n("ul",[n("li",[t._v("全局执行上下文：当 JavaScript 引擎第一次执行你的脚本时，它会创建一个全局的执行上下文并且压入当前执行栈")]),t._v(" "),n("li",[t._v("函数执行上下文：函数调用时会创建一个私有上下文，并压入栈的顶部，javascript 引擎会执行那些执行上下文位于栈顶的函数。当该函数执行结束时，执行上下文从栈中弹出，控制流程到达当前栈中的下一个上下文。")])])])]),t._v(" "),n("h3",{attrs:{id:"变量环境和记录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#变量环境和记录"}},[t._v("#")]),t._v(" 变量环境和记录")]),t._v(" "),n("ul",[n("li",[t._v("其实我们上面的讲解都是基于早期 ECMA 的版本规范：\n"),n("ul",[n("li",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20211021110058093.png",alt:"image-20211021110058093"}})])])]),t._v(" "),n("li",[t._v("在最新的 ECMA 的版本规范中，对于一些词汇进行了修改：\n"),n("ul",[n("li",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20211021110104549.png",alt:"image-20211021110104549"}})])])]),t._v(" "),n("li",[t._v("通过上面的变化我们可以知道，在最新的 ECMA 标准中，我们前面的变量对象 VO 已经有另外一个称呼了变量环境 VE。")])]),t._v(" "),n("h3",{attrs:{id:"执行过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行过程"}},[t._v("#")]),t._v(" 执行过程")]),t._v(" "),n("h4",{attrs:{id:"_1-初始化全局对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-初始化全局对象"}},[t._v("#")]),t._v(" 1 初始化全局对象")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("js 引擎会在执行代码之前，会在堆内存中创建一个全局对象：Global Object（GO）")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("该对象 所有的作用域（scoe）都可以访问；")])]),t._v(" "),n("li",[n("p",[t._v("里面会包含 Date、Array、String、Number、setTimeout、setInterval 等等；")])]),t._v(" "),n("li",[n("p",[t._v("其中还有一个 window 属性指向自己；")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20220531165544438.png",alt:"image-20220531165544438"}})]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20211021105714826.png",alt:"image-20211021105714826"}})])])])])]),t._v(" "),n("h4",{attrs:{id:"执行上下文栈-调用栈"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行上下文栈-调用栈"}},[t._v("#")]),t._v(" 执行上下文栈（调用栈）")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("js 引擎内部有一个执行上下文栈（ExecutioContext Stack，简称 ECS），它是用于执行代码的调用栈。那么现在它要执行谁呢？执行的是全局的代码块：")]),t._v(" "),n("ul",[n("li",[t._v("全局的代码块为了执行会构建一个全局执行上下文 Global ExecutioContext（GEC）；")]),t._v(" "),n("li",[t._v("GEC 会 被放入到 ECS 中 执行；")])])]),t._v(" "),n("li",[n("p",[t._v("GEC 被放入到 ECS 中里面包含两部分内容：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("第一部分：在代码执行前，在 arser 转成 AST 的过程中，会将全局定义的变量、函数等加入到 GlobalObject 中，但是并不会赋值；")]),t._v(" "),n("ul",[n("li",[t._v("这个过程也称之为变量的作用域提升（hoisting）")])])]),t._v(" "),n("li",[n("p",[t._v("第二部分：在代码执行中，对变量赋值，或者执行其他的函数；")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20220531165600021.png",alt:"image-20220531165600021"}})])])])])]),t._v(" "),n("h4",{attrs:{id:"_2-全局代码被执行前-全局执行上下文-gec-被放入到执行上下文栈-ecs-中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-全局代码被执行前-全局执行上下文-gec-被放入到执行上下文栈-ecs-中"}},[t._v("#")]),t._v(" 2 全局代码被执行前(全局执行上下文 GEC 被放入到执行上下文栈 ECS 中)")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20211021105730597.png",alt:"image-20211021105730597"}})]),t._v(" "),n("h4",{attrs:{id:"_3-全局代码执行过程后-gec-开始执行代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-全局代码执行过程后-gec-开始执行代码"}},[t._v("#")]),t._v(" 3 全局代码执行过程后(GEC 开始执行代码)")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20211021105743870.png",alt:"image-20211021105743870"}})]),t._v(" "),n("h4",{attrs:{id:"遇到函数如何执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#遇到函数如何执行"}},[t._v("#")]),t._v(" 遇到函数如何执行？")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("在执行的过程中执行到一个函数时，就会根据函数体创建一个函数执行上下文（Functional ExecutioContext，简称 FEC），并且压入到 EC Stack 中。")])]),t._v(" "),n("li",[n("p",[t._v("FEC 中包含三部分内容：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("当进入一个函数执行上下文时，会创建一个 AO 对象（Activation Object）；")])]),t._v(" "),n("li",[n("p",[t._v("这个 AO 对象会使用 arguments 作为初始化，并且初始值是传入的参数；")])]),t._v(" "),n("li",[n("p",[t._v("这个 AO 对象会作为执行上下文的 VO 来存放变量的初始化；")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20211021105919538.png",alt:"image-20211021105919538"}})]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20220531170231879.png",alt:"image-20220531170231879"}})])])])])]),t._v(" "),n("h4",{attrs:{id:"_4-函数被执行前-fec-被放入到-ecs-中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-函数被执行前-fec-被放入到-ecs-中"}},[t._v("#")]),t._v(" 4 函数被执行前(FEC 被放入到 ECS 中)")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20220531170333239.png",alt:"image-20220531170333239"}})]),t._v(" "),n("h4",{attrs:{id:"_5-函数执行过程后-fec-开始执行代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-函数执行过程后-fec-开始执行代码"}},[t._v("#")]),t._v(" 5 函数执行过程后(FEC 开始执行代码)")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20220531170412352.png",alt:"image-20220531170412352"}})]),t._v(" "),n("h2",{attrs:{id:"作用域和作用域链-scope-chain"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#作用域和作用域链-scope-chain"}},[t._v("#")]),t._v(" 作用域和作用域链（Scope Chain）")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("当进入到一个执行上下文时，执行上下文也会关联一个作用域链（Scope Chain）")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("作用域链是一个对象列表，用于变量标识符的求值；")])]),t._v(" "),n("li",[n("p",[t._v("当进入一个执行上下文时，这个作用域链被创建，并且根据代码类型，添加一系列的对象；")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/innovation66/picgo/main/image-20220531170530200.png",alt:"image-20220531170530200"}})])])])])]),t._v(" "),n("h3",{attrs:{id:"作用域提升面试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#作用域提升面试"}},[t._v("#")]),t._v(" 作用域提升面试")]),t._v(" "),n("ol",[n("li",[n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 200")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])])]),t._v(" "),n("li",[n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// undefined")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 200")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])])]),t._v(" "),n("li",[n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" n "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 200")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 100")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 100")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br")])])]),t._v(" "),n("li",[n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// undefined")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])])]),t._v(" "),n("li",[n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a未定义")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// b = 100 特殊情况")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br")])])])])])}),[],!1,null,null,null);a.default=r.exports}}]);